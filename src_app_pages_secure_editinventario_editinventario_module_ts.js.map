{"version":3,"file":"src_app_pages_secure_editinventario_editinventario_module_ts.js","mappings":"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","sources":["./src/app/pages/secure/editinventario/editinventario-routing.module.ts","./src/app/pages/secure/editinventario/editinventario.module.ts","./src/app/pages/secure/editinventario/editinventario.page.ts","./src/app/pages/secure/editinventario/editinventario.page.scss"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { EditinventarioPage } from './editinventario.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: EditinventarioPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class EditinventarioPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { EditinventarioPageRoutingModule } from './editinventario-routing.module';\n\nimport { EditinventarioPage } from './editinventario.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    EditinventarioPageRoutingModule,\n  ],\n  declarations: [EditinventarioPage],\n})\nexport class EditinventarioPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { HttpClient } from '@angular/common/http';\nimport { ToastController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-editinventario',\n  templateUrl: './editinventario.page.html',\n  styleUrls: ['./editinventario.page.scss'],\n})\nexport class EditinventarioPage implements OnInit {\n  productId: number;\n  initialQuantity: number;\n  nombre: string;\n  selledQuantity: number;\n  giftProducts: number;\n  wasteProducts: number;\n  selectedPvp: number;\n  date: string;\n  productos: any[] = []; // Arreglo de productos\n  selectedProduct: any; // Producto seleccionado\n\n  constructor(\n    private route: ActivatedRoute,\n    private http: HttpClient,\n    private router: Router,\n    private toastController: ToastController\n  ) {}\n\n  ngOnInit() {\n    this.route.params.subscribe((params) => {\n      const riCodigo = params['ri_codigo'];\n      const rfCodigo = params['rf_codigo'] || null;\n      this.loadProductData(riCodigo, rfCodigo);\n    });\n  }\n\n  onProductChange(event: any) {\n    const selectedProductId = event.detail.value;\n    this.selectedProduct = this.productos.find(\n      (product) => product.id === selectedProductId\n    );\n    if (this.selectedProduct) {\n      this.nombre = this.selectedProduct.nombre;\n      this.initialQuantity = this.selectedProduct.RI_CANTIDAD_INICIAL;\n      this.selectedPvp = this.selectedProduct.pvp;\n      this.selledQuantity = this.selectedProduct.RF_CANTIDAD_VENDIDA || 0;\n      this.giftProducts = this.selectedProduct.RF_PRODUCTOS_MUESTRA || 0;\n      this.wasteProducts = this.selectedProduct.RF_PRODUCTOS_DESECHADOS || 0;\n      this.date = this.selectedProduct.RI_FECHA;\n    }\n  }\n\n  loadProductData(riCodigo: number, rfCodigo: number | null) {\n    this.http\n      .post<any>('http://localhost/ACE/WsMunicipioIonic/ws_gad.php', {\n        accion: 'cargar_productos3',\n        ri_codigo: riCodigo,\n        rf_codigo: rfCodigo,\n      })\n      .subscribe(\n        (response) => {\n          if (response.estado) {\n            this.productos = response.datos;\n            console.log('Datos del producto cargados:', this.productos);\n            if (this.productos.length > 0) {\n              this.selectedProduct = this.productos[0];\n              this.nombre = this.selectedProduct.nombre;\n              this.initialQuantity = this.selectedProduct.RI_CANTIDAD_INICIAL;\n              this.selectedPvp = this.selectedProduct.pvp;\n              this.selledQuantity =\n                this.selectedProduct.RF_CANTIDAD_VENDIDA || 0;\n              this.giftProducts =\n                this.selectedProduct.RF_PRODUCTOS_MUESTRA || 0;\n              this.wasteProducts =\n                this.selectedProduct.RF_PRODUCTOS_DESECHADOS || 0;\n              this.date = this.selectedProduct.RI_FECHA;\n            }\n          } else {\n            console.error('Error al cargar producto:', response.mensaje);\n          }\n        },\n        (error) => {\n          console.error('Error en la solicitud:', error);\n        }\n      );\n  }\n\n  async saveProduct() {\n    if (this.selectedProduct) {\n      const updateData = {\n        accion: 'actualizar_cantidad_inicial',\n        ri_codigo: this.selectedProduct.RI_CODIGO,\n        nueva_cantidad: this.initialQuantity,\n      };\n\n      this.http\n        .post<any>(\n          'http://localhost/ACE/WsMunicipioIonic/ws_gad.php',\n          updateData\n        )\n        .subscribe(\n          async (response) => {\n            if (response.estado) {\n              await this.showToast(\n                'Cantidad inicial actualizada correctamente.'\n              );\n              this.router.navigate(['/inventariomenu']).then(() => {\n                window.location.reload(); // Recargar la página después de redirigir\n              });\n            } else {\n              console.error(\n                'Error al actualizar cantidad inicial:',\n                response.mensaje\n              );\n            }\n          },\n          (error) => {\n            console.error('Error en la solicitud:', error);\n          }\n        );\n    }\n  }\n\n  async saveFinal() {\n    if (this.selectedProduct) {\n      if (this.selledQuantity > this.initialQuantity) {\n        await this.showToast(\n          'La cantidad final no debe exceder el valor de la cantida Inicial.'\n        );\n        return;\n      }\n\n      const totalUsed =\n        this.selledQuantity + this.giftProducts + this.wasteProducts;\n      if (totalUsed > this.initialQuantity) {\n        await this.showToast(\n          'La cantidad final no debe exceder el valor de la cantida Inicial.'\n        );\n        return;\n      }\n\n      const updateData = {\n        accion: 'actualizar_registro_final',\n        rf_codigo: this.selectedProduct.RF_CODIGO,\n        ri_codigo: this.selectedProduct.RI_CODIGO,\n        cantidad_vendida: this.selledQuantity,\n        productos_muestra: this.giftProducts,\n        productos_desechados: this.wasteProducts,\n        dinero_total: this.selledQuantity * this.selectedPvp,\n      };\n\n      this.http\n        .post<any>(\n          'http://localhost/ACE/WsMunicipioIonic/ws_gad.php',\n          updateData\n        )\n        .subscribe(\n          async (response) => {\n            if (response.estado) {\n              await this.showToast('Registro final actualizado correctamente.');\n              this.router.navigate(['/inventariomenu']).then(() => {\n                window.location.reload(); // Recargar la página después de redirigir\n              });\n            } else {\n              console.error(\n                'Error al actualizar registro final:',\n                response.mensaje\n              );\n            }\n          },\n          (error) => {\n            console.error('Error en la solicitud:', error);\n          }\n        );\n    }\n  }\n\n  async showToast(message: string) {\n    const toast = await this.toastController.create({\n      message,\n      duration: 2000,\n      position: 'top',\n      color: 'success',\n    });\n    toast.present();\n  }\n}\n","// Imports\nvar ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\");\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"\", \"\",{\"version\":3,\"sources\":[],\"names\":[],\"mappings\":\"\",\"sourceRoot\":\"\"}]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___.toString();\n"],"names":["NgModule","RouterModule","EditinventarioPage","routes","path","component","EditinventarioPageRoutingModule","imports","forChild","exports","CommonModule","FormsModule","IonicModule","EditinventarioPageModule","declarations","Component","ActivatedRoute","Router","HttpClient","ToastController","constructor","route","http","router","toastController","ngOnInit","params","subscribe","riCodigo","rfCodigo","loadProductData","onProductChange","event","selectedProductId","detail","value","selectedProduct","productos","find","product","id","nombre","initialQuantity","RI_CANTIDAD_INICIAL","selectedPvp","pvp","selledQuantity","RF_CANTIDAD_VENDIDA","giftProducts","RF_PRODUCTOS_MUESTRA","wasteProducts","RF_PRODUCTOS_DESECHADOS","date","RI_FECHA","post","accion","ri_codigo","rf_codigo","response","estado","datos","console","log","length","error","mensaje","saveProduct","updateData","RI_CODIGO","nueva_cantidad","__awaiter","showToast","navigate","then","window","location","reload","saveFinal","totalUsed","RF_CODIGO","cantidad_vendida","productos_muestra","productos_desechados","dinero_total","message","toast","create","duration","position","color","present","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}