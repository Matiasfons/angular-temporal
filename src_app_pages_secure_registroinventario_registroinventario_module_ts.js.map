{"version":3,"file":"src_app_pages_secure_registroinventario_registroinventario_module_ts.js","mappings":"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","sources":["./src/app/pages/secure/registroinventario/registroinventario-routing.module.ts","./src/app/pages/secure/registroinventario/registroinventario.module.ts","./src/app/pages/secure/registroinventario/registroinventario.page.ts","./src/app/pages/secure/registroinventario/registroinventario.page.scss"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { RegistroinventarioPage } from './registroinventario.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: RegistroinventarioPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class RegistroinventarioPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { RegistroinventarioPageRoutingModule } from './registroinventario-routing.module';\n\nimport { RegistroinventarioPage } from './registroinventario.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RegistroinventarioPageRoutingModule\n  ],\n  declarations: [RegistroinventarioPage]\n})\nexport class RegistroinventarioPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AuthService } from 'src/app/services/auth/auth.service';\nimport { FormBuilder } from '@angular/forms';\nimport { ToastService } from 'src/app/services/toast/toast.service';\nimport { HttpClient } from '@angular/common/http';\nimport { AlertController, NavController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-registroinventario',\n  templateUrl: './registroinventario.page.html',\n  styleUrls: ['./registroinventario.page.scss'],\n})\nexport class RegistroinventarioPage implements OnInit {\n  codigo: string = '';\n  productos: any = [];\n  Productos: any = [];\n  searchTerm: string = '';\n\n  initial = {\n    product: '', // ID del producto seleccionado\n    productName: '', // Nombre del producto\n    quantity: 0, // Cantidad inicial\n    price: 0, // Precio de venta inicial\n    fechaRegistro: '', // Fecha de registro\n  };\n\n  final = {\n    sold: 0,\n    totalMoney: 0,\n    gifted: 0,\n  };\n\n  results = {\n    profitLoss: 0,\n    giftedLoss: 0,\n    remainingProducts: 0,\n  };\n\n  constructor(\n    private authService: AuthService,\n    private router: Router,\n    private formBuilder: FormBuilder,\n    private toastService: ToastService,\n    private http: HttpClient,\n    public navCtrl: NavController,\n    private alertController: AlertController\n  ) {\n    this.authService.getSession('productos').then((res: any) => {\n      this.codigo = res.codigo;\n      this.lproductos(this.codigo);\n    });\n  }\n\n  ngOnInit() {\n    // Inicializa la fecha de registro con la fecha actual\n    const today = new Date();\n    const year = today.getFullYear();\n    const month = String(today.getMonth() + 1).padStart(2, '0'); // Meses de 1 a 12\n    const day = String(today.getDate()).padStart(2, '0'); // Día del mes\n\n    this.initial.fechaRegistro = `${year}-${month}-${day}`;\n  }\n\n  async ionViewWillEnter() {\n    try {\n      const res = await this.authService.getSession('codigo');\n      this.codigo = res;\n      await this.lproductos(this.codigo);\n    } catch (error) {\n      console.error('Error al inicializar los datos', error);\n      this.authService.showToast(\n        'Error al cargar los datos. Por favor, intenta de nuevo.'\n      );\n    }\n  }\n\n  registerInitial() {\n    if (!this.initial.product) {\n      console.error('Por favor selecciona un producto.');\n      return;\n    }\n  \n    // Asegúrate de que `this.initial.product` sea un número\n    const productId = parseInt(this.initial.product, 10);\n  \n    console.log('ID del producto seleccionado:', productId);\n    console.log('Lista de productos:', this.productos);\n  \n    // Busca el objeto producto correspondiente al id seleccionado\n    const selectedProduct = this.productos.find(\n      (product) => parseInt(product.codigo, 10) === productId\n    );\n  \n    if (!selectedProduct) {\n      console.error('No se encontró el producto seleccionado en la lista.');\n      return;\n    }\n  \n    // Asigna el nombre del producto seleccionado al objeto inicial\n    this.initial.productName = selectedProduct.nombre;\n    this.initial.price = parseFloat(selectedProduct.pvp);\n  \n    // Llama al método para guardar los datos iniciales\n    this.guardarDatos();\n  }\n\n\n  guardarDatos() {\n    let datos = {\n      accion: 'guardar_inventario',\n      producto_id: this.initial.product, // Asegúrate de que esto sea el ID correcto del producto\n      cantidad_inicial: this.initial.quantity,\n      precio_venta: this.initial.price,\n      cantidad_vendida: this.final.sold,\n      dinero_total: this.final.totalMoney,\n      muestras: this.final.gifted,\n      ganancias_perdidas: this.results.profitLoss,\n      perdidas_productos_regalados: this.results.giftedLoss,\n      productos_no_vendidos: this.results.remainingProducts,\n      fecha_registro: this.initial.fechaRegistro, // Agregar la fecha de registro\n    };\n  \n    console.log('Datos a guardar:', datos); // Verifica los datos que se envían\n  \n    this.http\n      .post<any>('http://localhost/ACE/WsMunicipioIonic/ws_gad.php', datos)\n      .subscribe(\n        (response) => {\n          console.log('Datos guardados correctamente:', response);\n          if (response.estado) {\n            this.authService.showToast('Datos guardados correctamente.');\n          } else {\n            this.authService.showToast(response.mensaje);\n          }\n        },\n        (error) => {\n          console.error('Error en la solicitud:', error);\n          this.authService.showToast('Error al guardar los datos. Intenta de nuevo.');\n        }\n      );\n  }\n\n  lproductos(codigo: string) {\n    let datos = {\n      accion: 'lproductos',\n      cod_persona: this.codigo,\n    };\n    this.authService.postData(datos).subscribe((res: any) => {\n      if (res.estado === true) {\n        this.productos = res.datos;\n        this.Productos = res.datos; // Inicialmente muestra todos los productos\n        console.log('Productos cargados:', this.productos); // Verifica los productos cargados\n      } else {\n        this.authService.showToast(res.mensaje);\n      }\n    });\n  }\n\n  filterProductos(event: any) {\n    const searchTerm = event.target.value.toLowerCase();\n    this.Productos = this.productos.filter((producto: any) => {\n      return producto.nombre.toLowerCase().includes(searchTerm);\n    });\n  }\n  \n  updatePrice() {\n    if (!this.initial.product) {\n      console.warn('No se ha seleccionado ningún producto.');\n      return;\n    }\n  \n    const selectedProduct = this.productos.find(\n      (product) => product.codigo === this.initial.product // Asegúrate de que coincida el campo correcto\n    );\n  \n    if (selectedProduct) {\n      console.log('Producto seleccionado:', selectedProduct);\n      \n      if (selectedProduct.pvp !== undefined) {\n        this.initial.price = parseFloat(selectedProduct.pvp); // Convertir a número\n        console.log('Precio actualizado:', this.initial.price);\n      } else {\n        console.warn('El campo del precio no está definido para el producto seleccionado.');\n      }\n    }\n  \n    this.updateTotalMoney();\n  }\n  \n  updateTotalMoney() {\n    // Asegúrate de que `this.final.sold` y `this.initial.price` tengan valores válidos\n    if (this.final.sold >= 0 && this.initial.price >= 0) {\n      this.final.totalMoney = this.final.sold * this.initial.price;\n    } else {\n      console.warn('Cantidad vendida o precio no válidos.');\n    }\n  }\n  registerFinal(){\n    \n  }\n}  ","// Imports\nvar ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\");\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"\", \"\",{\"version\":3,\"sources\":[],\"names\":[],\"mappings\":\"\",\"sourceRoot\":\"\"}]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___.toString();\n"],"names":["NgModule","RouterModule","RegistroinventarioPage","routes","path","component","RegistroinventarioPageRoutingModule","imports","forChild","exports","CommonModule","FormsModule","IonicModule","RegistroinventarioPageModule","declarations","Component","Router","AuthService","FormBuilder","ToastService","HttpClient","AlertController","NavController","constructor","authService","router","formBuilder","toastService","http","navCtrl","alertController","product","productName","quantity","price","fechaRegistro","sold","totalMoney","gifted","profitLoss","giftedLoss","remainingProducts","getSession","then","res","codigo","lproductos","ngOnInit","today","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","initial","ionViewWillEnter","error","console","showToast","registerInitial","productId","parseInt","log","productos","selectedProduct","find","nombre","parseFloat","pvp","guardarDatos","datos","accion","producto_id","cantidad_inicial","precio_venta","cantidad_vendida","final","dinero_total","muestras","ganancias_perdidas","results","perdidas_productos_regalados","productos_no_vendidos","fecha_registro","post","subscribe","response","estado","mensaje","cod_persona","postData","Productos","filterProductos","event","searchTerm","target","value","toLowerCase","filter","producto","includes","updatePrice","warn","undefined","updateTotalMoney","registerFinal","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}