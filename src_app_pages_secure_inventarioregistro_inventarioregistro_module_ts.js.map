{"version":3,"file":"src_app_pages_secure_inventarioregistro_inventarioregistro_module_ts.js","mappings":"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","sources":["./src/app/pages/secure/inventarioregistro/inventarioregistro-routing.module.ts","./src/app/pages/secure/inventarioregistro/inventarioregistro.module.ts","./src/app/pages/secure/inventarioregistro/inventarioregistro.page.ts","./src/app/pages/secure/inventarioregistro/inventarioregistro.page.scss"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { InventarioregistroPage } from './inventarioregistro.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: InventarioregistroPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class InventarioregistroPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { InventarioregistroPageRoutingModule } from './inventarioregistro-routing.module';\n\nimport { InventarioregistroPage } from './inventarioregistro.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    InventarioregistroPageRoutingModule\n  ],\n  declarations: [InventarioregistroPage]\n})\nexport class InventarioregistroPageModule {}\n","import { HttpClient } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ToastController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-inventario-registro',\n  templateUrl: 'inventarioregistro.page.html',\n  styleUrls: ['inventarioregistro.page.scss'],\n})\nexport class InventarioregistroPage implements OnInit {\n  productId: string;\n  initialQuantity: number;\n  date: string;\n  selectedPvp: string;\n  productos: any[] = []; // Arreglo para almacenar los productos\n  initialRecordId: number; // Para almacenar el ID del registro inicial\n  idPersona: string;\n  isDateModalOpen = false; // Calendario\n\n  constructor(\n    private http: HttpClient,\n    private route: ActivatedRoute,\n    private router: Router,\n    private toastController: ToastController\n  ) {}\n\n  ngOnInit() {\n    this.idPersona = localStorage.getItem('CapacitorStorage.codigo');\n    console.log('ID Persona:', this.idPersona);\n    this.loadProducts();\n    this.setCurrentDate();\n  }\n\n  loadProducts() {\n    this.http\n      .post<any>('http://localhost/ACE/WsMunicipioIonic/ws_gad.php', {\n        accion: 'cargar_productos',\n        id_persona: this.idPersona,\n      })\n      .subscribe(\n        (response) => {\n          console.log('Respuesta del servidor:', response); // Depuración\n          if (response.estado) {\n            this.productos = response.datos;\n          } else {\n            console.error('Error al cargar productos:', response.mensaje);\n          }\n        },\n        (error) => {\n          console.error('Error en la solicitud:', error);\n        }\n      );\n  }\n\n  //--------------------------Funciones necesarias para el calendario-------------------------\n  openDateModal() {\n    this.isDateModalOpen = true;\n  }\n\n  closeDateModal() {\n    this.isDateModalOpen = false;\n  }\n\n  onDateModalDismiss(event: any) {\n    const selectedDate = event.detail?.value;\n    if (selectedDate) {\n      this.date = selectedDate.split('T')[0];\n    } else {\n      console.log('Modal cerrado sin seleccionar fecha');\n    }\n    this.closeDateModal();\n  }\n\n  confirmDate(selectedDate: string) {\n    this.date = selectedDate.split('T')[0];\n    this.closeDateModal();\n  }\n\n  //----------------------------------------------------------------------------------------\n\n  setCurrentDate() {\n    const today = new Date();\n    const offset = today.getTimezoneOffset(); // Obtener el desfase horario en minutos\n    const localDate = new Date(today.getTime() - offset * 60 * 1000); // Ajustar la fecha para la zona local\n    const formattedDate = localDate.toISOString().split('T')[0]; // Obtener la fecha en formato YYYY-MM-DD\n    this.date = formattedDate;\n  }\n\n  onProductChange(event: any) {\n    this.productId = event.detail.value;\n    const product = this.productos.find((p) => p.id === this.productId);\n    if (product) {\n      this.selectedPvp = product.pvp;\n      this.loadInitialQuantity(this.productId); // Nueva función para obtener la cantidad inicial\n    }\n  }\n\n  loadInitialQuantity(productId: string) {\n    this.http\n      .post<any>('http://localhost/ACE/WsMunicipioIonic/ws_gad.php', {\n        accion: 'obtener_cantidad_inicial',\n        producto_id: productId,\n      })\n      .subscribe(\n        (response) => {\n          if (response.estado) {\n            this.initialQuantity = response.cantidad_inicial;\n          } else {\n            console.error(\n              'Error al obtener la cantidad inicial:',\n              response.mensaje\n            );\n          }\n        },\n        (error) => {\n          console.error('Error en la solicitud:', error);\n        }\n      );\n  }\n\n  saveProduct() {\n    const datos = {\n      accion: 'guardar_inventario',\n      producto_id: this.productId,\n      cantidad_inicial: this.initialQuantity,\n      fecha_registro: this.date,\n    };\n\n    this.http\n      .post<any>('http://localhost/ACE/WsMunicipioIonic/ws_gad.php', datos)\n      .subscribe(\n        async (response) => {\n          if (response.estado) {\n            await this.showToast('Producto guardado exitosamente.');\n            this.router.navigate(['/inventariomenu']).then(() => {\n              window.location.reload(); // Recargar la página después de redirigir\n            });\n          } else {\n            await this.showToast(response.mensaje); // Mostrar mensaje de error\n          }\n        },\n        (error) => {\n          console.error('Error en la solicitud:', error);\n        }\n      );\n  }\n\n  async showToast(message: string) {\n    const toast = await this.toastController.create({\n      message,\n      duration: 2000,\n      position: 'top',\n      color: 'danger', // Cambia el color a rojo para los mensajes de error\n    });\n    toast.present();\n  }\n}\n","// Imports\nvar ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\");\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"ion-modal {\\n  --background: var(--ion-background-color, #fff);\\n  color: var(--ion-text-color, #000);\\n}\\n\\nion-datetime {\\n  --background: var(--ion-background-color, #fff);\\n  color: var(--ion-text-color, #000);\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/app/pages/secure/inventarioregistro/inventarioregistro.page.scss\"],\"names\":[],\"mappings\":\"AAAA;EACE,+CAAA;EACA,kCAAA;AACF;;AAEA;EACE,+CAAA;EACA,kCAAA;AACF\",\"sourcesContent\":[\"ion-modal {\\n  --background: var(--ion-background-color, #fff);\\n  color: var(--ion-text-color, #000);\\n}\\n\\nion-datetime {\\n  --background: var(--ion-background-color, #fff);\\n  color: var(--ion-text-color, #000);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___.toString();\n"],"names":["NgModule","RouterModule","InventarioregistroPage","routes","path","component","InventarioregistroPageRoutingModule","imports","forChild","exports","CommonModule","FormsModule","IonicModule","InventarioregistroPageModule","declarations","HttpClient","Component","ActivatedRoute","Router","ToastController","constructor","http","route","router","toastController","ngOnInit","idPersona","localStorage","getItem","console","log","loadProducts","setCurrentDate","post","accion","id_persona","subscribe","response","estado","productos","datos","error","mensaje","openDateModal","isDateModalOpen","closeDateModal","onDateModalDismiss","event","selectedDate","detail","value","date","split","confirmDate","today","Date","offset","getTimezoneOffset","localDate","getTime","formattedDate","toISOString","onProductChange","productId","product","find","p","id","selectedPvp","pvp","loadInitialQuantity","producto_id","initialQuantity","cantidad_inicial","saveProduct","fecha_registro","__awaiter","showToast","navigate","then","window","location","reload","message","toast","create","duration","position","color","present","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}